# [Template] Common build tasks shared between CI builds and PR validation.

steps:
# Build UWP x86
- template: tasks/unitybuild.yml
  parameters:
    Arch: 'x86'
    Platform: 'UWP'
    PublishArtifacts: true

# Build UWP ARM
- template: tasks/unitybuild.yml
  parameters:
    Arch: 'arm'
    Platform: 'UWP'
    UnityArgs: '-targetUwpSdk 10.0.18432.0'
    PublishArtifacts: true
    PackagingDir: 'ARM'

# Build UWP x86 .NET backend
- template: tasks/unitybuild.yml
  parameters:
    Arch: 'x86'
    Platform: 'UWP'
    PublishArtifacts: true
    ScriptingBackend: '.NET'

- powershell: |
   $AutoMrtkVersion = Get-Date -format "dd.MM.yyyy"
   .\build.ps1 -Version $AutoMrtkVersion -NoNuget
  displayName: 'Build Unity packages'

- powershell: |
   Get-ChildItem "." -Filter Build-UnityPackage*.log | 
   Foreach-Object {
       echo "=======================" "Contents of log file $_.FullName:" "======================="
       Get-Content $_.FullName
   }
  displayName: 'Echo packaging logs'

# Build Standalone x86
- template: tasks/unitybuild.yml
  parameters:
    Arch: 'x86'
    Platform: 'Standalone'

- template: assetretargeting.yml
- template: tests.yml
